<!DOCTYPE html><html lang="zn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Lidan的技术小窝</title><meta name="author" content="Lidan"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><header id="page_header"><div class="header_wrap"><div id="blog_name"><a class="blog_title" id="site-name" href="/">Lidan的技术小窝</a></div><button class="menus_icon"><div class="navicon"></div></button><ul class="menus_items"><li class="menus_item"><a class="site-page" href="/#Publications"> Publications</a></li><li class="menus_item"><a class="site-page" href="/"> About</a></li><li class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://crazyweirdo.xyz"> Blog</a></li></ul></div></header><main id="page_main"><div class="side-card sticky"><div class="card-wrap" itemscope itemtype="http://schema.org/Person"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/profile.png'" alt="avatar"></div><div class="author-discrip"><h3>Lidan</h3><p class="author-bio">Your biography can be writed down here.</p></div><div class="author-links"><button class="btn m-social-links">Links</button><ul class="social-icons"><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-facebook-square" aria-hidden="true"></i></a></li><li><a class="social-icon" href="github.com/lidan233" target="_blank"><i class="fab fa-github" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fab fa-weixin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="3235488378" target="_blank"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li><a class="social-icon" href="yuanli@zju.edu.cn" target="_blank"><i class="fas fa-envelope" aria-hidden="true"></i></a></li><li><a class="social-icon" href="/" target="_blank"><i class="fas fa-rss" aria-hidden="true"></i></a></li></ul><ul class="social-links"><li><a class="e-social-link" href="/" target="_blank"><i class="fas fa-graduation-cap" aria-hidden="true"></i><span>Google Scholar</span></a></li><li><a class="e-social-link" href="/" target="_blank"><i class="fab fa-orcid" aria-hidden="true"></i><span>ORCID</span></a></li></ul></div><a class="cv-links" href="/attaches/CV.pdf" target="_blank"><i class="fas fa-file-pdf" aria-hidden="true"><span>My Detail CV.</span></i></a></div></div><div class="page" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="page-title">SWC2obj项目输出</h2><article><h1 id="SWC2OBJ-BVH-metaball-swc2vol-vol2obj-mergeOBJ-smoothOBJ-https-github-com-lidan233-swc2obj"><a href="#SWC2OBJ-BVH-metaball-swc2vol-vol2obj-mergeOBJ-smoothOBJ-https-github-com-lidan233-swc2obj" class="headerlink" title="SWC2OBJ(BVH,metaball,swc2vol,vol2obj,mergeOBJ,smoothOBJ)[https://github.com/lidan233/swc2obj]"></a>SWC2OBJ(BVH,metaball,swc2vol,vol2obj,mergeOBJ,smoothOBJ)[<a target="_blank" rel="noopener" href="https://github.com/lidan233/swc2obj]">https://github.com/lidan233/swc2obj]</a></h1><h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><blockquote>
<p>将swc文件（一种人工标注的骨架文件）转化为光滑的obj,可以用于线和骨架膨胀之后转化为mesh，对应gis中的膨胀操作。这份代码提供了一份解决方案，也就是将一个骨架（人工标注的骨架）转化为光滑的mesh，并以obj的方式导出为mesh。</p>
</blockquote>
<h2 id="技术过程"><a href="#技术过程" class="headerlink" title="技术过程"></a>技术过程</h2><ol>
<li>我们都知道，要光滑拼接两个曲面是困难的，尤其是需要2阶光滑等光滑的性质的时候，因此要对物体进行膨胀和腐蚀操作，我们倾向于使用metaball算法。 </li>
<li>也即对骨架，以球的方式，以一定的步长，插值球的半径，进行体素化。(swc2vol:以metaball实现)</li>
<li>对体素化的数据进行marching cube得到对应的mesh。(vol2obj)</li>
<li>由于是超大规模体数据，所以需要对分块marching cube的mesh进行拼接，并保证近似水密性。(objmerge)</li>
<li>由于marchingcube的算法很不平滑，因此，我们使用taubin smooth算法进行smooth，得到局部光滑的mesh(obj).<br>swc2obj包含两个大的部分，包含四个部分swc2vol,vol2obj,objmerge,objsmooth(taubin smooth) </li>
</ol>
<h2 id="swc2vol"><a href="#swc2vol" class="headerlink" title="swc2vol"></a>swc2vol</h2><p>以分块BVH算法的情况，对swc进行体素化，并存储为多个体数据文件。</p>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><blockquote>
<p>对应cmake中的SWC2obj对象，命令行调用方式如下所示：</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">范式：</span><br><span class="line">SWC2Obj.exe -s the_path_to_swc_file -o the_path_to_save_vol_data -b block_size</span><br><span class="line">示例:</span><br><span class="line">C:/Users/lidan/Desktop/SWC2Obj/cmake-build-release/SWC2Obj.exe -s C:/Users/lidan/Desktop/brain/<span class="number">14193</span>_30neurons/N001.swc -o C:/Users/lidan/Desktop/SWC2Obj/newResult/ -b <span class="number">256</span></span><br></pre></td></tr></table></figure>

<h2 id="vol2obj"><a href="#vol2obj" class="headerlink" title="vol2obj"></a>vol2obj</h2><p>以分块并行marching cube的算法, 得到obj, 并写入到同一个文件中。（基于paraview的二次开发，鲁棒的marching cube算法，如果您对marching cube的算法好奇，请参照我的另一个<a target="_blank" rel="noopener" href="https://github.com/lidan233/surfaceReconstruct2Marchingcube">代码仓库</a></p>
<h3 id="使用说明-1"><a href="#使用说明-1" class="headerlink" title="使用说明"></a>使用说明</h3><blockquote>
<p>环境说明：因为cuda marchingcube对分块marchingcube的不支持, 所以我基于paraview二次开发出python脚本，并使用paraview封装的python解释器进行执行。我从善如流。我将paraview封装的解释器直接重命名为python4,希望paraview可以帮助到大家。</p>
</blockquote>
<blockquote>
<p>对应python脚本为vol2obj, 命令行调用方式如下所示：</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">范式:</span><br><span class="line">python4.obj volume2obj/main.py -i the_path_to_save_vol_data -o the_path_to_save_obj </span><br><span class="line">示例：</span><br><span class="line"><span class="string">&quot;D:/software/ParaView 5.8.1-Windows-Python3.7-msvc2015-64bit/bin/python4.exe&quot;</span> C:/Users/lidan/PycharmProjects/volume2obj/main.py -i C:/Users/lidan/Desktop/SWC2Obj/newResult/N001.swc -o C:/Users/lidan/Desktop/SWC2Obj/newResult/N001_use.obj </span><br></pre></td></tr></table></figure>


<h2 id="mergeOBJ"><a href="#mergeOBJ" class="headerlink" title="mergeOBJ"></a>mergeOBJ</h2><p>此时的OBJ中有很多重合点，这些重合点没有连接关系，所以目前的obj一平滑就会断掉，因此我们使用mergeOBJ合并这些重合点。<br>主要功能:读取obj,去重，合并相同节点，实现space坐标映射等。</p>
<h3 id="使用说明-2"><a href="#使用说明-2" class="headerlink" title="使用说明"></a>使用说明</h3><p>对应cmake对象为mergeOBJ, 命令行调用方式如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">范式：</span><br><span class="line">mergeOBJ.exe -i the_path_to_save_obj -o the_path_to_save_obj_without_repeat_vertex</span><br><span class="line">示例：</span><br><span class="line">C:/Users/lidan/Desktop/SWC2Obj/cmake-build-release/ObjMerge/mergeOBJ.exe -i  C:/Users/lidan/Desktop/SWC2Obj/newResult/N001_use.obj -o C:/Users/lidan/Desktop/SWC2Obj/newResult/N001_new_use.obj</span><br></pre></td></tr></table></figure>

<h2 id="smoothOBJ"><a href="#smoothOBJ" class="headerlink" title="smoothOBJ"></a>smoothOBJ</h2><p>试过meshlab很多的平滑算法，只有taubin算法最鲁棒，mu设为-0.1. </p>
<h3 id="使用说明-3"><a href="#使用说明-3" class="headerlink" title="使用说明"></a>使用说明</h3><p>对应cmake对象为smoothOBJ, 命令行调用方式如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">范式：</span><br><span class="line">python4 C:/Users/lidan/PycharmProjects/volume2obj/last.py -i the_path_to_inputobj -o the_path_to_outputobj</span><br><span class="line">示例：</span><br><span class="line"><span class="string">&quot;D:/software/ParaView 5.8.1-Windows-Python3.7-msvc2015-64bit/bin/python4.exe&quot;</span>  C:/Users/lidan/PycharmProjects/volume2obj/last.py -i C:/Users/lidan/Desktop/allobj/N001_new_use.obj -o C:/Users/lidan/Desktop/allobj/N001_new_use.obj</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p>以神经元为例:<br>开始线框：<br><img src="/images/0ee91e4526a40f2dbc0e15bde3fa0902b7c9247e062e72331f070a47172aa654.png" alt="picture 3"><br>最终效果<br><img src="/images/9c59be8086e897aa53630d1d4b39ffb1cfd8fd6dd876faa3bf9ca63505cc0844.png" alt="picture 1">  </p>
</article></div></main><div class="nav-wrap"><div class="nav"><button class="site-nav"><div class="navicon"></div></button><ul class="nav_items"><li class="nav_item"><a class="nav-page" href="/#Publications"> Publications</a></li><li class="nav_item"><a class="nav-page" href="/"> About</a></li><li class="nav_item"><a class="nav-page" target="_blank" rel="noopener" href="https://crazyweirdo.xyz"> Blog</a></li></ul></div><div class="cd-top"><i class="fa fa-arrow-up" aria-hidden="true"></i></div></div><footer id="page_footer"><div class="footer_wrap"><div class="copyright">&copy;2020 - 2021 by Lidan</div><div class="theme-info">Powered by <a target="_blank" href="https://hexo.io" rel="nofollow noopener">Hexo</a> & <a target="_blank" href="https://github.com/PhosphorW/hexo-theme-academia" rel="nofollow noopener">Academia Theme</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-pjax@latest/jquery.pjax.min.js"></script><script src="/js/main.js"></script></body></html>